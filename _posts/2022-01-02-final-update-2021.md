---
layout: post
title: Final update of 2021
subtitle: Wireless charging + E-stop features
gh-repo: adityakamath/akros
thumbnail-img: /assets/img/akros_cad2021_thumb.PNG
share-img: /assets/img/akros_cad2021_thumb.PNG
gh-badge: [follow]
comments: true
---

Happy new year! The last week of 2021 was supposed to be a week off in Italy, but it ended up being cancelled, so I decided to make some upgrades to the robot. For starters, the week before I had received some 12V/3A wireless charging modules, but I did not have a 24V power adapter to power the wireless transmitter coil. I decided to order it online, and while at that, I also found a shiny little emergency stop button which would fit quite snugly on the base module. While the parts arrived, I also decided to go ahead and design parts I would need to attach these to the robot. First and the most important change was the right side panel of the robot - I had to make space for the emergency stop button and send the design quickly to Snijlab so that they cut out this new design instead of the first one that I sent them.

<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_estop.jpg"/>
	<figcaption>Emergency Stop button wired to the robot</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_estop_panel.png"/>
	<figcaption>New side panel with hole for the E-stop button</figcaption>
</figure>
  
The button was wired between the voltage regulator and motor driver, which stops power to the motors. There is some back current from the Arduino, which drives the motors really slowly when the wheels are off the ground, but once the robot is placed on the ground, it doesn't move. This of course stops when the twist messages stop, and the arduino automatically stops the motor drivers. 
  
[![Testing an emergency stop button on a robot](https://adityakamath.github.io/assets/img/akros_estop_test_ss.png)](https://www.youtube.com/watch?v=J71T-Kv5zbg "[Testing an emergency stop button on a robot")

I also decided ot upgrade the software emergency stop. Currently, the robot is stopped from software by pushing the red circle button on the PS4 controller wehich publishes a boolean flag, which is used by the twist mixer to send twist messages with zero velocities, which would make the robot to stop. However, sometimes the communication is broken and the robot stores the previous twist message and goes wild. But since I now have the Arduino publishers and subscribers fixed, I decided to send the boolean flag directly to the Arduino, so that it can power off both the input and enable pins of each motor when the flag is set to true. I decided to go one step further and send the boolean flags of all the modes (auto/teleop/record/playback/estop) to the arduino by concatenating them into an integer and publishing that. This lets me act upon these mode changes from the Arduino - currently the code is set to change the LED colors based on the modes (to match the colors on the PS4 controller). I also decided to use twist_mux and the estop boolean flag as a lock to disable twist messagtes when the button is pressed. This stops the twist messages from being sent when the emergency stop is pressed, and using the publisher to the Arduino, it also disables the input pins for the motors and changes LED colors - so the robot comes to a complete halt without any doubts and turns red. Here's a quick video to show this:
  
[![Testing mode switching and software stop](https://adityakamath.github.io/assets/img/akros_sw_estop_test_ss.png)](https://www.youtube.com/watch?v=abgy8BhUo28 "[Testing mode switching and software stop")
  
The next step was to design parts for the wireless charging module. I glued the transmitter and receiver modules to two template pieces of acrylic for this prototype. Since these acrylic sheets follow the template of the base plate of the robot, it has holes in the right places, so I could simply screw it underneath to the robot with some spacers. Meanwhile, I received the power adapter so I could put the system to test. And I was blown away by how efficient it was. I could keep the coils apart, parallel to each other at a distance of up to 6cm and still be able to receive 12V/3A. In the horizontal plane, I was able to receive the required power even with an offset of at most 3cm. Since the voltage is already regulated on the receiver module, I plugged it directly to the input port of the UPS/batter onbooard the robot and did a little test.
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_wireless_modules.jpg"/>
	<figcaption>12V/3A (24V input) wireless charging modules</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_tx_proto.jpg"/>
	<figcaption>Transmitter module prototype</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_rx_10mm.jpg"/>
	<figcaption>Receiver module prototype on the transmitter module at a distance of 10mm (when robot is on the ground)</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_rx_40mm.jpg"/>
	<figcaption>Receiver module prototype on the transmitter module at a distance of 40mm (when robot is on the stand). Here the coil is turned upside down.</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_rx_proto.jpg"/>
	<figcaption>Receiver module prototype attached to the robot</figcaption>
</figure>
  
[![Testing wireless charging for robots](https://adityakamath.github.io/assets/img/akros_wireless_charging_test_ss.png)](https://www.youtube.com/watch?v=068xM-MQ7Ls "[Testing wireless charging for robots")
  
I then went on to design the parts I would need in Fusion 360. The receiver module that fits onto the robot has three parts, an acrylic base plate to hold everything, and two 3D printed covers for the coil and the receiver module. I've left enough space for a voltage regulater (if needed) and space for an RGB LED and a small microcontroller to light up the LED when charging. The acrylic piece also has a curved end, which fits into a notch on the transmitter module.
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_rx_cad.png"/>
	<figcaption>Receiver module CAD design with an acrylic base plate and two 3D printed parts, attached 40mm from the robot chassis with spacers</figcaption>
</figure>

<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_rx_robot_cad.png"/>
	<figcaption>AKROS CAD design with the receiver module attached</figcaption>
</figure>
  
The transmitter module is also made up of 3D printed and laser cut acrylic parts. They hold the transmitter module, the transmitter coil, a female socket for the power adapter plug. This module also has a curved notch where the receiver module of the robot can simply fit into. I've also designed a stand for the robot, which I can use for testing. This hopefully will be CNCed in wood, if the workshop I've been meaning to attend finally happens in 2022. There are also notches on the transmitter module where this stand and the robot can fit into. This notch method keeps the transmitter and receiver coils perfectly aligned when the robot is on the ground or on the stand and maintains enough distance between the transmitter and receiver coils to allow for charging.
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_tx_cad.png"/>
	<figcaption>Receiver module CAD design with acrylic and 3D printed parts, placed on the ground. The curved end of the receiver module fits into the curved side on the transmitter</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_tx_robot_cad.png"/>
	<figcaption>CAD design with the robot base plate, and the transmitter and receiver modules. The transmitter module is placed on the ground, and the distance between the transmitter and receiver modules is slightly less than 10mm.</figcaption>
</figure>
  
<figure class="aligncenter">
	<img src="https://adityakamath.github.io/assets/img/akros_tx_robot_stand_cad.png"/>
	<figcaption>AKROS CAD design with both transmitter and receiver modules. The robot is placed on a wooden stand, due to which the distance between the transmitter and receiver modules is around 35mm, which provides the same efficiency as with a 10mm distance. The transmitter, receiver modules and the stand all fit into each other</figcaption>
</figure>
  
For my next steps, I dont have a lot planned for the next few weeks. I have to finalize the CAD design, get everything 3D printed or laser cut. Then, I also need to wait for the side panels and attach them. I still need to do more tests with the wireless charging modules, since the receiver coild is so close to the motors and the hall effect sensors. I'm afraid it will interfere, but in any case, I do not need to use the encoders while charging. Unfortunately, I still need to drive the robot to dock/undock, which might be a problem. Next weekend, I also want to write a long blog about everything I was able to do and learn in 2021. After that, a Covid booster shot and some proper time off.
